CREATE TABLE users (
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE directories (
    directory_id INT AUTO_INCREMENT PRIMARY KEY,
    directory_name VARCHAR(255) NOT NULL,
    path VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE resources (
    resource_id INT AUTO_INCREMENT PRIMARY KEY,
    resource_name VARCHAR(255) NOT NULL,
    type VARCHAR(255),
    size BIGINT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE user_directory (
    user_id INT NOT NULL,
    directory_id INT NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
    FOREIGN KEY (directory_id) REFERENCES directories(directory_id) ON DELETE CASCADE,
    PRIMARY KEY (user_id, directory_id)
);

CREATE TABLE directory_resource (
    directory_id INT NOT NULL,
    resource_id INT NOT NULL,
    FOREIGN KEY (directory_id) REFERENCES directories(directory_id) ON DELETE CASCADE,
    FOREIGN KEY (resource_id) REFERENCES resources(resource_id) ON DELETE CASCADE,
    PRIMARY KEY (directory_id, resource_id)
);

CREATE TABLE permissions (
    permission_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    directory_id INT NOT NULL,
    permission_type ENUM('GUEST', 'STANDARD', 'ADMIN') NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
    FOREIGN KEY (directory_id) REFERENCES directories(directory_id) ON DELETE CASCADE
);

CREATE TABLE history (
    history_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    resource_id INT NOT NULL,
    action_type VARCHAR(50) NOT NULL,
    history_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
    FOREIGN KEY (resource_id) REFERENCES resources(resource_id) ON DELETE CASCADE
);

CREATE TABLE transfers (
    transfer_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    resource_id INT NOT NULL,
    destination_user_id INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
    FOREIGN KEY (resource_id) REFERENCES resources(resource_id) ON DELETE CASCADE,
    FOREIGN KEY (destination_user_id) REFERENCES users(user_id) ON DELETE CASCADE
);





-- Insert users
INSERT INTO users (username, email, password) VALUES
    ('user1', 'user1@example.com', 'password1'),
    ('user2', 'user2@example.com', 'password2'),
    ('user3', 'user3@example.com', 'password3');

-- Insert directories
INSERT INTO directories (directory_name, path) VALUES
    ('user1', '/directories/user1'),
    ('user2', '/directories/user2'),
    ('user3', '/directories/user3');

-- Insert resources
INSERT INTO resources (resource_name, type, size) VALUES
    ('File 1', 'txt', 1024),
    ('File 2', 'png', 2048),
    ('File 3', 'pdf', 3072),
    ('File 4', 'doc', 4096);



INSERT INTO directory_resource (directory_id, resource_id) VALUES
(1, 1),
(1, 2),
(2, 3),
(3, 4);



INSERT INTO user_directory (user_id, directory_id) VALUES
(1, 1),
(1, 2),
(2, 1),
(3, 3);


-- Insert permissions
INSERT INTO permissions (user_id, directory_id, permission_type) VALUES
    (1, 1, 'ADMIN'),
    (2, 1, 'STANDARD'),
    (3, 2, 'GUEST');

-- Insert history
INSERT INTO history (user_id, resource_id, action_type) VALUES
    (1, 1, 'UPLOAD'),
    (2, 2, 'DOWNLOAD'),
    (1, 3, 'DELETE'),
    (1, 1, 'VIEW'),
    (1, 2, 'DOWNLOAD'),
    (2, 1, 'UPLOAD'),
    (3, 4, 'SHARE');

-- Insert transfers
INSERT INTO transfers (user_id, resource_id, destination_user_id) VALUES
    (1, 2, 2),
    (2, 3, 1),
    (3, 4, 2);

